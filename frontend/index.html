<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>News Portal</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Lato:400,300,700,900" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <!--These four are needed for 'Write A Post CSS and Bootstrap'-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.2.2/web3.min.js"></script>

</head>


<body>

    <section id="LoginDiv" class="login-div">
        <p id="pleaseLogIn">Log In Using MetaMask Wallet</p>
        <button id="connect" class="login-button">LOGIN</button>
      </section>

  <!-- ======= Header ======= -->
  <section id="header">
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center">

      <div class="logo me-auto">
        <h1><a href="#hero">News Portal</a></h1>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="#hero" onclick="ChangeTab.goToHome();">News</a></li>
          <li><a class="nav-link scrollto" id= 'lifestyleButton' href="#lifestyle" onclick="ChangeTab.goToLifestyle();">Lifestyle</a></li>
          <li><a class="nav-link scrollto" id = 'techButton' href="#tech" onclick="ChangeTab.goToTech();">Tech</a></li>
          <li><a class="nav-link scrollto" href="#admin" onclick="ChangeTab.goToAdminPanel();">Panel</a></li>
          <li><a class="nav-link scrollto" href="index.html">Logout</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav>
    </div>

  </header><!-- End #header -->
</section>

<!-- ======= Hero Section ======= -->
<section id="HeroDiv">
  <section id="hero">
    <div class="hero-container">
      <h1>Welcome to News Portal</h1>
      <h2>Here you can find news about Lifestyle and Tech</h2>
    </div>
  </section>
</section>
<!--end of the hero div section-->

  <main id="main">

    <!-- ======= Our Lifestyle Section ======= -->
    <div id="LifestyleDiv">
      <!-- ======= Detailed Lifestyle Section ======= -->
      <section id="lifestyle-details" class="lifestyle">
        <div class="container">
          <div class="section-title">
            <h2>LIFESTYLE</h2>
          </div>
          <div id="welcomeParagraph">
            <p>Welcome to our Lifestyle section, where we explore the vibrant tapestry of modern living. Here, we curate a diverse array of articles that delve into the latest trends, tips, and insights shaping the way we lead our lives. From fashion and travel to health and wellness, our Lifestyle section is your go-to source for inspiration, information, and a glimpse into the ever-evolving world of contemporary living. Join us as we navigate the intersection of style, culture, and well-being, bringing you stories that celebrate the richness of life in all its facets. Whether you're seeking advice on personal development, exploring the hottest travel destinations, or staying updated on the latest lifestyle trends, we invite you to embark on this journey with us. Welcome to a space dedicated to enhancing your everyday experiences and helping you live your best life.</p>
          </div>
        
          <div id="genrePostsContainer" class="card-container"></div> <!-- ======= NOVO 2======= -->
          <div id="detailedPost" style="display: none;"></div> <!-- ======= NOVO 2======= -->

        </div>
      </section>
      <!-- End of Detailed Lifestyle Section -->
    </div>


    <!-- ======= Our Tech Section ======= -->
    <div id="TechDiv">
      <!-- ======= Detailed Tech Section ======= -->
      <section id="tech-details" class="tech">
        <div class="container">
          <div class="section-title">
            <h2>TECH</h2>
          </div>
          <div id="welcomeParagraph">
            <p>Hello and welcome to our Tech section, your ultimate gateway to the ever-evolving realm of digital innovation. Immerse yourself in a world of cutting-edge gadgets, explore emerging software trends, and gain valuable insights into the dynamic tech industry. From the fascinating realms of AI to the crucial domain of cybersecurity, we've got you covered. Stay seamlessly connected to the forefront of technology, as we bring you the latest developments in the world of electronics. Whether you're a seasoned tech enthusiast or someone simply curious about the future, our mission is to inform and inspire you in this rapidly evolving digital landscape. Join us in this dedicated space where we decode innovation, offering you a front-row seat to the thrilling pulse of tech that shapes our tomorrow. Welcome to a journey where knowledge meets inspiration in the ever-expanding universe of technology.</p>
          </div>

          <div id="genrePostsContainer2" class="card-container"></div> <!-- ======= NOVO 2======= -->
          <div id="detailedPost2" style="display: none;"></div> <!-- ======= NOVO 2======= -->

        </div>
      </section>
      <!-- End of Detailed Tech Section -->
    </div>

  
  <div id="adminDiv">
    <!-- ======= Admin Section ======= -->
    <section id="admin">
        <!-- Add your admin content here -->
        <h2>WELCOME ADMIN!</h2>

         <!-- Post Count Display NOVO -->
        <p id="postCountDisplay">Number of posts: <span id="postCount">0</span></p>

        <!-- Write Posts Button for Admin id="writePostBtn"-->
        <button id="writePostBtn" style="display: none;">Write A Post</button>
        <button id="deletePostBtn" style="display: none;">Delete A Post</button>
        <button id="addANewAdmin" style="display: none;">Add a New Admin</button>
        
        <div id="postsList">
            <table class="table">
                <thead>
                    <tr>
                        <th>Post ID</th>
                        <th>Title</th>
                        <th>Genre</th>
                    </tr>
                </thead>
                <tbody id="postTableBody">
                    <!-- Ovdje idu redovi za posts -->
                </tbody>
            </table>
        </div>

        <!-- Write Posts Form for Admin -->
        <div id="writePosts" style="display: none;">
            <h1>Create Post</h1>
            <form id="postForm">
                <div class="form-group">
                    <label for="genre">Genre</label>
                    <input type="text" class="form-control" id="genre" required>
                </div>
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" class="form-control" id="title" required>
                </div>
                <div class="form-group">
                    <label for="content">Content</label>
                    <textarea class="form-control" id="content" rows="5" required></textarea>
                </div>
                <button type="button" class="btn btn-primary" id="submitPost">Submit Post</button>
                <button class="btn btn-default" id="cancelPost"> Cancel </button>
            </form>
        </div>

            <!--Delete Button Prompt-->
        <div id="deletePostModal" style="display: none;">
            <form>
                <div class="form-group">
                    <label for="deletePostID">Enter Post ID to Delete</label>
                    <input type="text" class="form-control" id="deletePostID" placeholder="Post ID">
                </div>
                <button type="button" class="btn btn-primary" id="confirmDelete">Save changes</button>
                <button type="button" class="btn btn-secondary" id="cancelDelete">Close</button>
            </form>
        </div>

            <!--Add a New Admin Prompt-->
            <div id="addANewAdminModal" style="display: none;">
                <form>
                    <div class="form-group">
                        <label for="adminAddress">Enter New Admin Address to Save</label>
                        <input type="text" class="form-control" id="adminAddress" placeholder="New Admin Address">
                    </div>
                    <button type="button" class="btn btn-primary" id="confirmNewAdmin">Save changes</button>
                    <button type="button" class="btn btn-secondary" id="cancelNewAdmin">Close</button>
                </form>
            </div>

    </section>
    <!-- End ADMIN Section -->


    <!-- Div for User NOVO 2 -->
    <div id="userDiv" style="display: none;"> 
        <!-- Add your user content here -->
        <h2>WELCOME USER!</h2>
        <p id="connectedAddress" style="display: block; font-weight: normal; text-align: center;">This is your address: <span style="text-decoration: underline"></span></p>
        <h3>Dear user, if you have any question, feel free to contact us by submiting this form: </h3>
        <br>

        <!-- Write Help Desk Service Information for User -->
        <div id="writeHelpDeskItem" style="display: none;">
            <form id="postForm2">
                <div class="form-group">
                    <label for="topic">Topic</label>
                    <input type="text" class="form-control" id="topic" required>
                </div>
                <div class="form-group">
                    <label for="contentOfProblem">Content</label>
                    <textarea class="form-control" id="contentOfProblem" rows="5" required></textarea>
                </div>
                <button type="button" class="btn btn-primary" id="submitRequest">Submit</button>
                <button class="btn btn-default" id="cancelRequest"> Cancel </button>
            </form>
        </div>
  
    </div>
</div>


</main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>News Portal</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        Designed by <a>NewsPortal</a>
      </div>
    </div>
  </footer><!-- End #footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!--<script src="assets/js/ChangeTab.js"></script>-->

  <script>
    var ChangeTab = {
      goToHome: function () {
        $("#HeroDiv").show();
        $("#LifestyleDiv, #TechDiv, #adminDiv,  #NewsDiv").hide();
      },
      goToLifestyle: function () {
        $("#LifestyleDiv").show();
        $("#HeroDiv, #TechDiv, #adminDiv,  #NewsDiv").hide();
      },
      goToTech: function () {
        $("#TechDiv").show();
        $("#LifestyleDiv, #HeroDiv, #adminDiv, #NewsDiv").hide();
      },
      goToAdminPanel: function () {
        $("#adminDiv").show();
        $("#TechDiv, #LifestyleDiv, #HeroDiv, #NewsDiv").hide();
      },
      goToNews: function () {
        $("#NewsDiv").show();
        $("#TechDiv, #LifestyleDiv, #HeroDiv, #adminDiv").hide();
      }
    };
  
  </script>


<script>

    const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"}],"name":"PostDeletedEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"helpDeskItemID","type":"uint256"},{"indexed":false,"internalType":"string","name":"topic","type":"string"},{"indexed":false,"internalType":"string","name":"content","type":"string"}],"name":"helpDeskItemWrittenEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_newAdminAddress","type":"address"}],"name":"newAdminAddedEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"string","name":"genre","type":"string"},{"indexed":false,"internalType":"string","name":"title","type":"string"},{"indexed":false,"internalType":"string","name":"content","type":"string"}],"name":"newPostCreatedEvent","type":"event"},{"inputs":[{"internalType":"address","name":"newAdmin","type":"address"}],"name":"addAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"}],"name":"deletePost","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllPosts","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"genre","type":"string"},{"internalType":"string","name":"title","type":"string"},{"internalType":"string","name":"content","type":"string"}],"internalType":"struct NewsPortal.Post[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_wantedGenre","type":"string"}],"name":"getAllPostsPerGenre","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"genre","type":"string"},{"internalType":"string","name":"title","type":"string"},{"internalType":"string","name":"content","type":"string"}],"internalType":"struct NewsPortal.Post[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getCurrentPostCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_topic","type":"string"},{"internalType":"string","name":"_content","type":"string"}],"name":"writeHelpDeskItem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_genre","type":"string"},{"internalType":"string","name":"_title","type":"string"},{"internalType":"string","name":"_content","type":"string"}],"name":"writePosts","outputs":[],"stateMutability":"nonpayable","type":"function"}];
        //Najnoviji ABI

$(document).ready(function () {
    $('#header, #footer, #HeroDiv, #LifestyleDiv, #TechDiv, #adminDiv, #NewsDiv').hide();
    $('#LoginDiv').show(); // Show the login section by default

$('#connect').click(async function () {
if (window.ethereum) {   
    let addresses = await window.ethereum.request({ method: 'eth_requestAccounts' });
    //console.log(addresses[0]);
    window.web3 = new Web3(window.ethereum);
    deployed_contract = '0xDc53a9B2BceEfF5e177E44b4A25179abD86C1Dbb'; //Najnoviji
    
    const contract = new web3.eth.Contract(abi, deployed_contract);
    const adminAddress = "0x4A6D300C16fDbEc06AD04Bf56f79C69B82F7e191"; // JA
    const lowerCaseAdminAddress = adminAddress.toLowerCase();

    const adminAddress2 = "0xBFfB885Ee9adeF105Ced97e74577606eF1a85284"; // ILMA
    const lowerCaseAdminAddress2 = adminAddress2.toLowerCase();

    const userAddress = "0x75E573a1c77362FB81E739B1117007A3BE2423dF"; // ILMA - User
    const lowerCaseUserAddress = userAddress.toLowerCase();

    $('#connectedAddress > span').html(addresses[0]);
    
    $('#connect').hide();
    $('#LoginDiv').hide();
    $('#header, #footer, #HeroDiv').show();



    if (addresses[0] === lowerCaseAdminAddress || addresses[0] === lowerCaseAdminAddress2) {
        
        $('#postCountDisplay').show(); //NOVO
        $('postCount').show(); //NOVO
        $('#writePostBtn').show();
        $('#deletePostBtn').show();
        $('#addANewAdmin').show();

        displayPostsByGenre('Lifestyle'); // NOVO 3
        displayPostsByGenre2('Tech'); //NOVO 3
        getAllPosts();
        updatePostCount(); //NOVO 2

        async function displayPostsByGenre(genre) {
        let posts = await contract.methods.getAllPostsPerGenre(genre).call();
    
        let postsContainer = $('#genrePostsContainer');
        postsContainer.empty();

        posts.forEach((post, index) => {
            let postId = 'post_' + index;
            let postCard = `
                <div class="card" id="${postId}">
                  <div class="card-header">${post.genre}</div>
                  <div class="card-body">
                    <h5 class="card-title">${post.title}</h5>
                    <button class="btn btn-primary read-more-btn">Read More</button>
                  </div>
                </div>
            `;

            postsContainer.append(postCard);

            $('#' + postId + ' .read-more-btn').click(function() {
                // Hide the card
                $('#' + postId).hide();

                // Show the detailed post content
                $('#detailedPost').html(`
                <div class="col-12 pt-4 pt-lg-0 order-2 order-lg-1 full-width-text">
  <h3>${post.title}</h3>
  <p>${post.content}</p>
  <button class="btn btn-primary back-btn">Back</button>
</div>
                    
                `).show();
                
                // Back button functionality
                $('.back-btn').click(function() {
                    $('#detailedPost').hide();
                    $('#' + postId).show();
                });
            });
        });
    }

        async function displayPostsByGenre2(genre) {


        let posts = await contract.methods.getAllPostsPerGenre(genre).call();
        
        let postsContainer = $('#genrePostsContainer2');
        postsContainer.empty();

        posts.forEach((post, index) => {
            let postId = 'post_' + index;
            let postCard = `
                <div class="card" id="${postId}">
                  <div class="card-header">${post.genre}</div>
                  <div class="card-body">
                    <h5 class="card-title">${post.title}</h5>
                    <button class="btn btn-primary read-more-btn">Read More</button>
                  </div>
                </div>
            `;

            postsContainer.append(postCard);

            $('#' + postId + ' .read-more-btn').click(function() {
                // Hide the card
                $('#' + postId).hide();

                                // Show the detailed post content
                $('#detailedPost2').html(`
                    <div class="row">
                    <div class="col-lg-6 order-1 order-lg-2">
                      <img src="assets/img/about-img.jpg" class="img-fluid" alt="">
                    </div>
                    <div class="col-lg-6 pt-4 pt-lg-0 order-2 order-lg-1">
                      <h3>${post.title}</h3>
                      <p>${post.content}</p>
                      <button class="btn btn-primary back-btn">Back</button>
                    </div>
                    </div>
                `).show();

                

                // Back button functionality
                $('.back-btn').click(function() {
                    $('#detailedPost2').hide();
                    $('#' + postId).show();
                });
            });
        });
    }

    


        $('#lifestyleButton').click(function() {
            displayPostsByGenre('Lifestyle');
        });

        $('#techButton').click(function() {
            displayPostsByGenre2('Tech');
        });


        $('#writePostBtn').click(function () {
            // Show the create post form for admins
            $('#writePosts').show();
            $('#postsList').hide();
            $('#writePostBtn').hide();
        });

        contract.events.newPostCreatedEvent()
        .on('data', function (event) {
        console.log("New post created: ", event);
        $('#writePosts').hide();
        $('#postsList').show();
        $('#writePostBtn').show();
        $('#deletePostBtn').show();
        $('#addANewAdmin').show();
        getAllPosts();
        updatePostCount(); //NOVO
        displayPostsByGenre(event.returnValues.genre); //ovo treba da se update tamo na drugim ekranima
        displayPostsByGenre2(event.returnValues.genre); //ovo treba da se update tamo na drugim ekranima

        });
    

    // Handle submit post button click
    $('#submitPost').click(async function () {
        const genre = $('#genre').val();
        const title = $('#title').val();
        const content = $('#content').val();

        try {
            await contract.methods.writePosts(genre, title, content).send({ from: addresses[0] }).then(function (result) {
                alert('Post created successfully!');
                $('#genre').val(''); //NOVO 2
                $('#title').val(''); //NOVO 2
                $('#content').val(''); //NOVO 2
                    
            });
        } catch (error) {
            console.error("Error creating post:", error);
        }
    });

    $('#cancelPost').click(function () {
        //event.stopPropagation();
        event.preventDefault(); //zasad radi sa ovim
        $('#title').val(''); //NOVO
        $('#genre').val(''); //NOVO
        $('#content').val(''); //NOVO
        $('#writePosts').hide();
        $('#postsList').show();
        $('#writePostBtn').show();
        getAllPosts();
    });


    async function getAllPosts() {
        let addresses = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const contract = new web3.eth.Contract(abi, deployed_contract);
        let posts = await contract.methods.getAllPosts().call({ from: addresses[0] });
        //console.log(posts);

        let tableContent = '';

        for (let i = 0; i < posts.length; i++) {
            tableContent += `
                <tr>
                    <td>${posts[i].id}</td>
                    <td>${posts[i].title}</td>
                    <td>${posts[i].genre}</td>
                </tr>
            `;
        }

        $('#postTableBody').html(tableContent);  // Update the content of the postTableBody
    }

    $('#deletePostBtn').click(function () {
      // Show the delete post modal
      $('#deletePostModal').show();
      $('#postsList').hide();
      $('#deletePostBtn').hide();
    });

    $('#addANewAdmin').click(function () {
      // Show the add admin post modal
      $('#addANewAdminModal').show();
      $('#postsList').hide();
      $('#addANewAdmin').hide();
    });


$('#confirmDelete').click(async function () {
    let postIdToDelete = $('#deletePostID').val();
    let parsedPostIdToDelete = parseInt(postIdToDelete, 10);
    console.log("Post ID to delete:", parsedPostIdToDelete);

    try {
        let posts = await contract.methods.getAllPosts().call({ from: addresses[0] });
        let maxPostId = Math.max(...posts.map(post => parseInt(post.id, 10)));

        if (isNaN(parsedPostIdToDelete) || parsedPostIdToDelete > maxPostId) {
            alert('Invalid Post ID: Entered ID is invalid or does not exist.');
            return;
        }

        await contract.methods.deletePost(parsedPostIdToDelete).send({ from: addresses[0] })
            .then(function (result) {
                alert('Post deleted successfully!');
                // Refresh the post list if needed
                getAllPosts();
            });
    } catch (error) {
        console.error("Error deleting post:", error);
        alert('Failed to delete post. Error: ' + error.message);
    }

    $('#deletePostModal').hide(); // Hide the modal after attempting deletion
    // Additional UI updates as needed
});
  

    $('#cancelDelete').click(function () {
        // Hide the modal and clear the input field
        $('#deletePostID').val('');
        $('#deletePostModal').hide();
        $('#postsList').show();
        $('#deletePostBtn').show();
        $('#addANewAdmin').show();

    });


    contract.events.PostDeletedEvent()
            .on('data', function (event) {
            console.log("Post deleted: ", event);
        //$('#deletePosts').hide();
            $('#postsList').show();
            getAllPosts();
            //updatePostCount();  //NOVO
            $('#writePostBtn').show();
            $('#deletePostBtn').show();
            $('#addANewAdmin').show();
            displayPostsByGenre(event.returnValues.genre); //da se update i na drugim ekranima
            displayPostsByGenre2(event.returnValues.genre); //da se update i na drugim ekranima

            });

    async function deletePost(postId) {
    try {
        await contract.methods.deletePost(postId).send({ from: addresses[0] })
        .then(function (result) {
            alert('Post deleted successfully!');
            //getAllPosts();
        });
    } catch (error) {
        console.error("Error deleting post:", error);
        alert('Failed to delete post.');
    }
    }

    async function updatePostCount() {
    try {
        let postCount = await contract.methods.getCurrentPostCount().call({ from: addresses[0] });
        $('#postCount').text(postCount);
    } catch (error) {
        console.error("Error fetching post count:", error);
    }
}

//Functions to add a new admin
$('#confirmNewAdmin').click(async function () {
    const newAdmin = $('#adminAddress').val();

    try {
            await contract.methods.addAdmin(newAdmin).send({ from: addresses[0] }).then(function (result) {
                alert('New Admin added successfully!');

                    
            });
        } catch (error) {
            console.error("Error while adding a new admin:", error);
        }

        $('#addANewAdminModal').hide(); 
    });
  

    $('#cancelNewAdmin').click(function () {
        // Hide the modal and clear the input field
        $('#adminAddress').val('');
        $('#addANewAdminModal').hide();
        $('#postsList').show();
        $('#deletePostBtn').show();
        $('#addANewAdmin').show();

    });


    contract.events.newAdminAddedEvent()
            .on('data', function (event) {
            console.log("New Admin added: ", event);
        //$('#deletePosts').hide();
            $('#postsList').show();
            getAllPosts();
            //updatePostCount();  //NOVO
            $('#writePostBtn').show();
            $('#deletePostBtn').show();
            $('#addANewAdmin').show();
            //displayPostsByGenre(event.returnValues.genre); //da se update i na drugim ekranima
            });

  } //END FOR ADMIN

         else{
            // For regular users, show user content
            $('#admin').hide();
            $('#postCountDisplay').hide(); //NOVO 2
            $('postCount').hide(); //NOVO 2
            $('#userDiv').show();
            $('#genrePostsContainer').show();
            $('#connectedAddress').show();
            $('#connectedAddress > span').html(addresses);
            $('#writeHelpDeskItem').show();
            


//KOMENTARII
async function displayPostsByGenre(genre) {
    let posts = await contract.methods.getAllPostsPerGenre(genre).call();
    
    let postsContainer = $('#genrePostsContainer');
    postsContainer.empty();

    posts.forEach((post, index) => {
        let postId = 'post_' + index;
        let postCard = `
            <div class="card" id="${postId}">
              <div class="card-header">${post.genre}</div>
              <div class="card-body">
                <h5 class="card-title">${post.title}</h5>
                <button class="btn btn-primary read-more-btn">Read More</button>
              </div>
            </div>
        `;

        postsContainer.append(postCard);

        $('#' + postId + ' .read-more-btn').click(function() {
            // Hide the card
            $('#' + postId).hide();

            // Show the detailed post content
           
                              // Show the detailed post content
                $('#detailedPost').html(`
                    <div class="row">
                    <div class="col-lg-6 order-1 order-lg-2">
                      <img src="assets/img/about-img.jpg" class="img-fluid" alt="">
                    </div>
                    <div class="col-lg-6 pt-4 pt-lg-0 order-2 order-lg-1">
                      <h3>${post.title}</h3>
                      <p>${post.content}</p>
                      <button class="btn btn-primary back-btn">Back</button>
                    </div>
                    </div>
                `).show();
      // Back button functionality
      $('.back-btn').click(function() {
                      $('#detailedPost').hide();
                      $('#' + postId).show();
                  });

        });
    });
}

// Event delegation for dynamic elements
$(document).on('click', '.read-more-btn', function() {
    let postId = $(this).parent().parent().attr('id').split("_")[1];
    currentPostId = postId; // Store the current post ID

    let post = posts.find(p => p.id === postId);

    $('.card').hide();
    $('#detailedPost').html(`
        <h3>${post.title}</h3>
        <p>${post.content}</p>
        <button class="btn btn-secondary back-btn">Back</button>
    `).show();
    
});



// Initialize the display for a specific genre
$('#lifestyleButton').click(function() {
    displayPostsByGenre('Lifestyle');
});

$('#techButton').click(function() {
    displayPostsByGenre2('Tech');
});


             

async function displayPostsByGenre2(genre) {
    let posts = await contract.methods.getAllPostsPerGenre(genre).call();
    
    let postsContainer = $('#genrePostsContainer2');
    postsContainer.empty();

    posts.forEach((post, index) => {
        let postId = 'post_' + index;
        let postCard = `
            <div class="card" id="${postId}">
              <div class="card-header">${post.genre}</div>
              <div class="card-body">
                <h5 class="card-title">${post.title}</h5>
                <button class="btn btn-primary read-more-btn">Read More</button>
              </div>
            </div>
        `;

        postsContainer.append(postCard);

        $('#' + postId + ' .read-more-btn').click(function() {
            // Hide the card
            $('#' + postId).hide();

                            // Show the detailed post content
                $('#detailedPost2').html(`
                    <div class="row">
                    <div class="col-lg-6 order-1 order-lg-2">
                      <img src="assets/img/about-img.jpg" class="img-fluid" alt="">
                    </div>
                    <div class="col-lg-6 pt-4 pt-lg-0 order-2 order-lg-1">
                      <h3>${post.title}</h3>
                      <p>${post.content}</p>
                      <button class="btn btn-primary back-btn">Back</button>
                    </div>
                    </div>
                `).show();

      // Back button functionality
      $('.back-btn').click(function() {
                      $('#detailedPost2').hide();
                      $('#' + postId).show();
                  });

        });
    });
}

// Event delegation for dynamic elements
$(document).on('click', '.read-more-btn', function() {
  let postId = $(this).parent().parent().attr('id').split("_")[1];
    currentPostId = postId; // Store the current post ID

    let post = posts.find(p => p.id === postId);

    // Hide all cards and show detailed post content
    $('.card').hide();
    $('#detailedPost2').html(`
        <h3>${post.title}</h3>
        <p>${post.content}</p>
        <button class="btn btn-secondary back-btn">Back</button>
    `).show();
  
});


// Initialize the display for a specific genre
$('#lifestyleButton').click(function() {
    displayPostsByGenre('Lifestyle');
});

$('#techButton').click(function() {
    displayPostsByGenre2('Tech');
});


    contract.events.helpDeskItemWrittenEvent()
        .on('data', function (event) {
        console.log("New help desk item created: ", event);
        $('#topic').val(''); 
        $('#contentOfProblem').val('');
        
        });
    

    // Handle submit post button click
    $('#submitRequest').click(async function () {
        const topic = $('#topic').val();
        const contentOfProblem = $('#contentOfProblem').val();

        if (contentOfProblem.length > 250 ) {
        alert('Problem description is too long. Please provide a shorter description.');
        return;
    }

        try {
            await contract.methods.writeHelpDeskItem(topic, contentOfProblem).send({ from: addresses[0] }).then(function (result) {
                alert('Your request has been successfully sent!');
                //$('#topic').val(''); 
                //$('#contentOfProblem').val('');
                    
            });
        } catch (error) {
            console.error("Error while submitting the rquest:", error);
        }
    });

    $('#cancelRequest').click(function () {
        //event.stopPropagation();
        event.preventDefault(); //zasad radi sa ovim
        $('#topic').val(''); 
        $('#contentOfProblem').val('');
    });

    
    







        }}
    });

    
    
    });
    </script>

  </body>

</html>